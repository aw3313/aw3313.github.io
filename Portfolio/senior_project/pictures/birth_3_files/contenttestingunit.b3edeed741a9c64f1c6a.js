(window.webpackJsonp=window.webpackJsonp||[]).push([["modules/contenttestingunit"],{"6d9e9d7753ee511c5aa5":function(t,h,u){"use strict";u.r(h),function(t,i,e){var n=u("8d0684f10c3cea737a13"),a=u("a2b997b8b278a0820277"),r=u("e5f201a09441168159e8"),s=u("d46c288b6d4387f2b7de"),o=u("891a19eb7d3552f95f46"),c=u("abfbe0c0349d83b0558c"),l=u("664242c59047c2802440"),d=u("654adc4d2d3e5dbaee18");h.default=t.View.extend({events:{"click .ct-unit-heading, .ct-unit-title, .ct-unit-image-container":"handleUnitClicked"},customEvents:{viewed:"ct_promo_viewed",clicked:"ct_promo_clicked",error:"ct_promo_content_unavail"},initialize:function(){this.setVariables(),this.$window.one(this.ensightenEvent,this.initializeUnit.bind(this))},setVariables:function(){this.$window=i(window),this.overrideDefaults({babouEndpoint:"/b",babouUrl:window.BABOU_URL,params:{pub:window.VARIANT_PUB||""},ensightenEvent:"showpromounit",mediaLoader:null,target:"#content-testing-target",unitTemplate:"#content-testing-template"}),this.tracker=null,this.mediaLoader=Object(d.c)(this.mediaLoader,c.default),this.logger=new o.a("ContentTestingUnit")},initializeUnit:function(){i.ajax({url:this.babouUrl+this.babouEndpoint,data:this.params}).done(this.handleBabouResponse.bind(this)).fail(this.handleBabouError.bind(this))},handleBabouResponse:function(t){var e=t.body;return e&&Object.prototype.hasOwnProperty.call(e,"resource_url")&&Object.prototype.hasOwnProperty.call(e,"id")?(this.contentVariantId=this.getContentVariantIdFromResponse(e.id),this.variantId=this.contentVariantId.split("."),2!==this.variantId.length?this.handleBabouError(null,"Malformed variant id."):(this.variantId=this.variantId[1],this.renderUnit(e),this.initializeTracker(),n.a.on("scroll",this.handleScroll.bind(this),"contenttestingunit"),!0)):this.handleBabouError(null,"Bad response body.")},renderUnit:function(t){var e;t.variant_url=this.getContentVariantUrl(Object(d.i)("resource_url",t,""),this.contentVariantId),e=new s.a({model:new r.a({body:t}),templateSelector:this.unitTemplate}).render().el,e=i(e).insertBefore(this.target),this.setElement(e),this.trackingPixels=new l.a},initializeTracker:function(){this.tracker=new a.a({url:this.babouUrl,params:{_i:this.contentVariantId,pub:this.params.pub}}),this.tracker.track(this.tracker.signals.LOAD_PROMO)},handleBabouError:function(t,e){this.logger.log("Babou Error",t,e),this.trigger(this.customEvents.error,"none")},handleScroll:function(t){var e=t+window.innerHeight;this.$el.length&&this.$el.offset().top<=e&&(n.a.off("scroll","contenttestingunit"),this.trigger(this.customEvents.viewed,this.variantId),this.tracker.track(this.tracker.signals.VIEW_PROMO))},handleUnitClicked:e.once(function(){return this.trigger(this.customEvents.clicked,this.variantId),this.tracker.track(this.tracker.signals.CLICK_PROMO),!0}),getContentVariantIdFromResponse:function(t){return t.split(".").splice(1,2).join(".")},getContentVariantUrl:function(t,e){var i=e.split(".").shift(),n=document.createElement("a");return n.href=t.replace(i,e),n.pathname=n.pathname.replace(/\/?$/,"/"),n.search+=(-1<n.search.indexOf("?")?"&":"")+"click=mvtest",n.href},trigger:function(t,e){var i=new CustomEvent(t,{detail:e});window.dispatchEvent(i)}})}.call(this,u("292bef011bf0a540c727"),u("4124695a4a0df23fd56c"),u("37047f07c1f267630157"))}}]);
//# sourceMappingURL=contenttestingunit.b3edeed741a9c64f1c6a.js.map